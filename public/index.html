<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>S0LACE</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<link rel="shortcut icon" href="favicon.ico" />
<link rel="stylesheet" href="index.css" />

<script src="/scram/scramjet.all.js"></script>
<script src="register-sw.js" defer></script>
<script src="global-hub.js" defer></script>

<style>
:root { --fg: #fff; --fg-dim: #888; --accent: #00ffcc; --bg: #0a0a0a; }
body { min-height: 100vh; margin: 0; background: var(--bg); color: var(--fg); font-family: sans-serif; overflow-x: hidden; }
main { min-height: 100vh; display: flex; justify-content: center; align-items: center; }

.home-wrap { max-width: 720px; width: 100%; padding: 32px; text-align: center; }

/* Fixed Font Styling */
.home-title { 
    font-family: 'Press Start 2P', cursive; 
    font-size: 64px; 
    font-weight: 800; 
    color: var(--fg); 
    margin: 0;
}
.home-version { margin-top: 14px; font-size: 10px; font-family: "Press Start 2P"; color: var(--fg-dim); }

.home-status {
  margin-top: 16px;
  font-family: "Press Start 2P";
  font-size: 10px;
  display: flex;
  justify-content: center;
  gap: 10px;
  color: var(--fg-dim);
}

#clock { color: var(--fg); }
#battery { color: var(--accent); }

.proxy-wrap { margin-top: 28px; }
#sj-address {
  width: 100%;
  padding: 18px 22px;
  font-size: 16px;
  border-radius: 16px;
  background: rgba(255,255,255,0.05);
  color: var(--fg);
  border: 2px solid var(--accent);
  outline: none;
  box-sizing: border-box;
}

.visitor-meta {
  margin-top: 36px;
  display: flex;
  justify-content: center;
  gap: 28px;
  font-family: "Press Start 2P";
  font-size: 10px;
  color: var(--fg-dim);
}
.visitor-meta span { color: var(--accent); }
</style>
</head>
<body>

<nav class="side-header">
  <a href="index.html" class="side-icon" data-icon="home"><img></a>
  <a href="games.html" class="side-icon" data-icon="games"><img></a>
  <a href="media.html" class="side-icon" data-icon="media"><img></a>
  <a href="settings.html" class="side-icon" data-icon="settings"><img></a>
</nav>

<main>
<div class="home-wrap">
  <div class="home-title">S0LACE</div>
  <div class="home-version">v1.2.0</div>

  <div class="home-status">
    <span id="clock">--:--</span>
    <span>•</span>
    <span id="battery">--%</span>
  </div>

  <div class="proxy-wrap">
    <form id="sj-form">
      <input type="hidden" id="sj-search-engine" value="https://www.google.com/search?q=%s">
      <input id="sj-address" placeholder="Enter a URL or search Google" autocomplete="off">
    </form>
  </div>

  <div class="visitor-meta">
    <div>TODAY <span id="vis-today">—</span></div>
    <div>WEEK <span id="vis-week">—</span></div>
    <div>ALL <span id="vis-all">—</span></div>
  </div>
</div>
</main>

<script>
// UI & CLOCK
function getAccent(){ return localStorage.getItem("s0laceAccent") || "gray"; }
function updateIcons(){
  document.querySelectorAll(".side-icon").forEach(a => {
    const img = a.querySelector("img");
    if(!img) return;
    const icon = a.dataset.icon;
    const active = window.location.pathname.includes(a.getAttribute('href'));
    img.src = `thumbs/${icon}/${active ? getAccent() : "gray"}.png`;
  });
}
updateIcons();

function updateClock(){
  const d=new Date();
  let h=d.getHours(), m=String(d.getMinutes()).padStart(2,"0");
  const ap=h>=12?"PM":"AM"; h=h%12||12;
  document.getElementById("clock").textContent = `${h}:${m} ${ap}`;
}
updateClock(); setInterval(updateClock, 1000);

if(navigator.getBattery){
  navigator.getBattery().then(b => {
    const u = () => document.getElementById("battery").textContent = Math.round(b.level * 100) + "%";
    u(); b.onlevelchange = u; b.onchargingchange = u;
  });
}

// PROXY HANDLER
document.getElementById("sj-form").addEventListener("submit", e => {
  e.preventDefault();
  const address = document.getElementById("sj-address").value.trim();
  const engine = document.getElementById("sj-search-engine").value;
  
  if(!address) return;

  const url = /^https?:\/\//i.test(address) ? address : engine.replace("%s", encodeURIComponent(address));
  
  // Call Scramjet directly - simplified for reliability
  if (window.scramjet) {
    window.scramjet.open(url);
  } else {
    console.error("Scramjet script not loaded yet.");
    // Fallback if the script is there but object name differs
    if (typeof scramjet !== 'undefined') scramjet.open(url);
  }
});
</script>

<script type="module">
import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"
import { getDatabase, ref, get, runTransaction } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"

const cfg = {
  apiKey: "AIzaSyBbgy76ThxHaKlOhpiLQ6Nw4ekR1b9t3DA",
  databaseURL: "https://s0lace-web-default-rtdb.firebaseio.com",
  projectId: "s0lace-web"
};

async function initStats() {
    try {
        const app = getApps().length ? getApps()[0] : initializeApp(cfg);
        const db = getDatabase(app);

        const today = () => new Date().toISOString().split("T")[0];
        const week = () => {
            const d = new Date(), j = new Date(d.getFullYear(), 0, 1);
            return "week_" + Math.ceil((((d - j) / 86400000) + j.getDay() + 1) / 7);
        }

        if(!sessionStorage.getItem("s0lace-counted")){
            sessionStorage.setItem("s0lace-counted", "1");
            runTransaction(ref(db, "visitors/all"), v => (v || 0) + 1);
            runTransaction(ref(db, "visitors/today/" + today()), v => (v || 0) + 1);
            runTransaction(ref(db, "visitors/week/" + week()), v => (v || 0) + 1);
        }

        const [a, t, w] = await Promise.all([
            get(ref(db, "visitors/all")),
            get(ref(db, "visitors/today/" + today())),
            get(ref(db, "visitors/week/" + week()))
        ]);

        document.getElementById("vis-all").textContent = a.val() || 0;
        document.getElementById("vis-today").textContent = t.val() || 0;
        document.getElementById("vis-week").textContent = w.val() || 0;
    } catch (e) {
        console.error("Firebase Error:", e);
    }
}
initStats();
</script>
</body>
</html>
