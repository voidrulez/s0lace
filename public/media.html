<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>S0LACE • Media</title>

    <link rel="shortcut icon" content="favicon.ico" />
    <link rel="stylesheet" href="index.css" />
    <script src="global-hub.js" defer></script>
  </head>

  <body>
    <header class="site-header">
      <div class="site-title">S0LACE</div>
      <nav class="site-nav">
        <a href="index.html">Home</a>
        <a href="games.html">Games</a>
        <a href="media.html" class="active">Media</a>
        <a href="apps.html">Apps</a>
        <a href="settings.html">Settings</a>
      </nav>
    </header>

    <main>
      <div class="page-header">
        <h1>Media</h1>
        <div class="sub">
          <span>Auto-updating</span> TMDB-powered movie browser. Trending by
          default — search for any movie below.
        </div>
      </div>

      <!-- SEARCH BAR -->
      <div class="games-search-wrap">
        <span class="search-label">SEARCH &gt;</span>
        <input
          id="media-search"
          type="text"
          placeholder="type a movie and press Enter..."
          autocomplete="off"
        />
      </div>

      <!-- TMDB STATUS -->
      <div
        id="tmdb-status"
        style="font-size: 9px; color: #7f7f7f; margin: 4px 0 10px;"
      >
        Loading popular movies from TMDB…
      </div>

      <div class="media-grid" id="media-grid"></div>

      <div id="media-empty" style="display:none;">
        No movies found.
      </div>
    </main>

    <script>
      // ===== TMDB CONFIG =====
      const TMDB_KEY = "2d1351cf74f73892042699d0431b799a";
      const TMDB_IMG_BASE = "https://image.tmdb.org/t/p/";
      const TMDB_IMG_SIZE = "w600_and_h900_face"; // ONE size only

      const mediaSearch = document.getElementById("media-search");
      const mediaGrid = document.getElementById("media-grid");
      const mediaEmpty = document.getElementById("media-empty");
      const tmdbStatus = document.getElementById("tmdb-status");

      function goToPlayer(title, src) {
        const url =
          "mediaplayer.html?src=" +
          encodeURIComponent(src) +
          "&title=" +
          encodeURIComponent(title);
        window.location.href = url;
      }

      function wireCardClick(card) {
        card.addEventListener("click", (e) => {
          e.preventDefault();
          const title = card.dataset.title;
          const id = card.dataset.tmdbId;
          goToPlayer(title, "/scram/https://cinemaos.live/player/" + id);
        });
      }

      function createCard(movie) {
        const id = movie.id;
        const title = movie.title || movie.name || "Untitled";
        const posterPath = movie.poster_path;

        const a = document.createElement("a");
        a.className = "media-card tmdb-card";
        a.href = "#";
        a.dataset.title = title;
        a.dataset.tmdbId = id;

        const thumb = document.createElement("div");
        thumb.className = "poster-thumb";

        const img = document.createElement("img");
        img.alt = title;

        if (posterPath) {
          img.src = TMDB_IMG_BASE + TMDB_IMG_SIZE + posterPath;
        } else {
          img.src = "thumbs/placeholder-poster.png";
        }

        const overlay = document.createElement("div");
        overlay.className = "media-overlay";
        overlay.textContent = title;

        thumb.appendChild(img);
        thumb.appendChild(overlay);
        a.appendChild(thumb);

        wireCardClick(a);
        return a;
      }

      function clearTmdbCards() {
        document.querySelectorAll(".tmdb-card").forEach((e) => e.remove());
      }

      async function loadTrending() {
        tmdbStatus.textContent = "Loading trending…";

        const res = await fetch(
          `https://api.themoviedb.org/3/trending/movie/day?api_key=${TMDB_KEY}&language=en-US`
        );

        const data = await res.json();
        const results = data.results || [];

        clearTmdbCards();
        mediaEmpty.style.display = "none";

        const fragment = document.createDocumentFragment();
        results.slice(0, 24).forEach((m) => fragment.appendChild(createCard(m)));

        mediaGrid.prepend(fragment);
        tmdbStatus.textContent = "Trending movies";
      }

      async function searchTMDB(q) {
        if (!q.trim()) return loadTrending();

        tmdbStatus.textContent = `Searching "${q}"…`;

        const res = await fetch(
          `https://api.themoviedb.org/3/search/movie?api_key=${TMDB_KEY}&language=en-US&page=1&include_adult=false&query=${encodeURIComponent(
            q
          )}`
        );

        const data = await res.json();
        const results = data.results || [];

        clearTmdbCards();

        if (!results.length) {
          mediaEmpty.style.display = "block";
          tmdbStatus.textContent = `No results for "${q}".`;
          return;
        }

        mediaEmpty.style.display = "none";

        const fragment = document.createDocumentFragment();
        results.slice(0, 30).forEach((m) => fragment.appendChild(createCard(m)));

        mediaGrid.prepend(fragment);
        tmdbStatus.textContent = `Results for "${q}"`;
      }

      document.addEventListener("DOMContentLoaded", () => {
        loadTrending();

        mediaSearch.addEventListener("keyup", (e) => {
          if (e.key === "Enter") searchTMDB(mediaSearch.value);
        });
      });
    </script>
  </body>
</html>
