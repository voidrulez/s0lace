<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S0LACE • Media</title>

  <link rel="shortcut icon" content="favicon.ico" />
  <link rel="stylesheet" href="index.css" />
  <script src="global-hub.js" defer></script>

  <style>
    /* TAB BAR */
    .media-tabs {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
    }
    .media-tab {
      cursor: pointer;
      padding: 6px 14px;
      border-radius: 6px;
      font-weight: 600;
      background: #111;
      border: 1px solid #333;
      color: #aaa;
      transition: 0.2s;
    }
    .media-tab.active {
      background: #fff;
      color: #000;
    }

    /* HORIZONTAL SEARCH */
    .media-search-wrap {
      display: flex;
      align-items: center;
      gap: 10px;
      width: 100%;
      margin: 10px 0 20px;
    }
    #media-search {
      flex: 1;
      padding: 10px 14px;
      border-radius: 6px;
      border: 1px solid #333;
      background: #0b0b0b;
      color: white;
    }
  </style>
</head>

<body>
<header class="site-header">
  <div class="site-title">S0LACE</div>
  <nav class="site-nav">
    <a href="index.html">Home</a>
    <a href="games.html">Games</a>
    <a href="media.html" class="active">Media</a>
    <a href="apps.html">Apps</a>
    <a href="settings.html">Settings</a>
  </nav>
</header>

<main>
  <div class="page-header">
    <h1>Media</h1>
    <div class="sub">TMDB-powered movies + TV browser.</div>
  </div>

  <!-- TABS -->
  <div class="media-tabs">
    <div class="media-tab active" id="tab-movies">MOVIES</div>
    <div class="media-tab" id="tab-tv">TV SHOWS</div>
  </div>

  <!-- SEARCH INPUT -->
  <div class="media-search-wrap">
    <input id="media-search" type="text" placeholder="search and press Enter..." autocomplete="off" />
  </div>

  <!-- STATUS -->
  <div id="tmdb-status" style="font-size: 9px; color:#7f7f7f;">Loading…</div>

  <div class="media-grid" id="media-grid"></div>
  <div id="media-empty" style="display:none;">No results.</div>
</main>

<script>
  // ========= CONFIG =========
  const TMDB_KEY = "2d1351cf74f73892042699d0431b799a";
  const IMG_BASE = "https://image.tmdb.org/t/p/";
  const IMG_SIZE = "w600_and_h900_face";

  // ========= ELEMENTS =========
  const grid = document.getElementById("media-grid");
  const statusEl = document.getElementById("tmdb-status");
  const emptyEl = document.getElementById("media-empty");
  const searchInput = document.getElementById("media-search");

  const tabMovies = document.getElementById("tab-movies");
  const tabTV = document.getElementById("tab-tv");

  let mode = "movie"; // "movie" OR "tv"

  // ========= UI HELPERS =========
  function setMode(newMode) {
    mode = newMode;

    tabMovies.classList.toggle("active", mode === "movie");
    tabTV.classList.toggle("active", mode === "tv");

    searchInput.value = "";
    loadTrending();
  }

  function clearCards() {
    document.querySelectorAll(".tmdb-card").forEach(e => e.remove());
  }

  function showEmpty(show) {
    emptyEl.style.display = show ? "block" : "none";
  }

  // ========= CARD BUILDER =========
  function createCard(item) {
    const id = item.id;
    const title = item.title || item.name;
    const poster = item.poster_path;

    const card = document.createElement("a");
    card.className = "media-card tmdb-card";
    card.href = "#";
    card.dataset.title = title;
    card.dataset.tmdbId = id;
    card.dataset.type = mode;

    const thumb = document.createElement("div");
    thumb.className = "poster-thumb";

    const img = document.createElement("img");
    img.alt = title;
    img.src = poster ? IMG_BASE + IMG_SIZE + poster : "thumbs/placeholder-poster.png";

    const overlay = document.createElement("div");
    overlay.className = "media-overlay";
    overlay.textContent = title;

    thumb.appendChild(img);
    thumb.appendChild(overlay);
    card.appendChild(thumb);

    // Movie: /player/id
    // TV: /tv/{id}/{season}/{episode} → handled later
    card.addEventListener("click", (e) => {
      e.preventDefault();

      const type = card.dataset.type;
      const id = card.dataset.tmdbId;
      const title = card.dataset.title;

      const url =
        "mediaplayer.html?type=" + type +
        "&id=" + encodeURIComponent(id) +
        "&title=" + encodeURIComponent(title);

      window.location.href = url;
    });

    return card;
  }

  // ========= TMDB LOADERS =========
  async function loadTrending() {
    statusEl.textContent = "Loading trending " + mode + "…";
    clearCards();
    showEmpty(false);

    const endpoint =
      mode === "movie"
        ? "trending/movie/day"
        : "trending/tv/day";

    const res = await fetch(`https://api.themoviedb.org/3/${endpoint}?api_key=${TMDB_KEY}&language=en-US`);
    const data = await res.json();

    const results = data.results || [];
    if (!results.length) {
      statusEl.textContent = "No trending found.";
      return;
    }

    const frag = document.createDocumentFragment();
    results.slice(0, 24).forEach(item => frag.appendChild(createCard(item)));
    grid.prepend(frag);

    statusEl.textContent = "Trending " + (mode === "movie" ? "movies" : "TV shows");
  }

  async function searchTMDB(q) {
    if (!q.trim()) return loadTrending();

    statusEl.textContent = `Searching "${q}"…`;
    clearCards();
    showEmpty(false);

    const endpoint =
      mode === "movie"
        ? "search/movie"
        : "search/tv";

    const res = await fetch(
      `https://api.themoviedb.org/3/${endpoint}?api_key=${TMDB_KEY}&language=en-US&query=${encodeURIComponent(q)}`
    );

    const data = await res.json();
    const results = data.results || [];

    if (!results.length) {
      showEmpty(true);
      statusEl.textContent = `No results for "${q}".`;
      return;
    }

    const frag = document.createDocumentFragment();
    results.slice(0, 40).forEach(item => frag.appendChild(createCard(item)));
    grid.prepend(frag);

    statusEl.textContent = `Results for "${q}"`;
  }

  // ========= INIT =========
  document.addEventListener("DOMContentLoaded", () => {
    loadTrending();

    tabMovies.onclick = () => setMode("movie");
    tabTV.onclick = () => setMode("tv");

    searchInput.addEventListener("keyup", (e) => {
      if (e.key === "Enter") searchTMDB(searchInput.value);
    });
  });
</script>

</body>
</html>
