<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <title>S0LACE • TV Player</title>

    <link rel="shortcut icon" content="favicon.ico" />
    <link rel="stylesheet" href="index.css" />
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <script src="baremux/index.js"></script>
    <script src="epoxy/index.js"></script>
    <script src="register-sw.js" defer></script>
    <script src="global-hub.js" defer></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8373843490344171"
     crossorigin="anonymous"></script>

    <style>
      body {
        margin: 0; padding: 0; height: 100%;
        background-color: #0f0f0f;
        display: flex; /* Sidebar sits next to main */
        overflow: hidden;
      }

      .player-main {
        display: flex; flex-direction: column;
        height: 100vh; width: 100%;
        font-family: 'Press Start 2P', cursive;
      }

      /* TV SHELL - RESTYLED WITH CURVES */
      .tv-shell {
        flex: 1;
        margin: 15px 15px 5px 15px;
        background: #050505;
        border-radius: 20px;
        padding: 15px;
        border: 2px solid #1a1a1a;
        display: flex;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      }

      .tv-main-layout {
        flex: 1;
        display: grid;
        grid-template-columns: minmax(0, 3.4fr) minmax(220px, 1.3fr);
        gap: 15px;
      }

      /* LEFT PLAYER AREA */
      .tv-left { display: flex; flex-direction: column; gap: 10px; }

      .player-frame-wrap {
        position: relative;
        flex: 1;
        background: #000;
        border-radius: 15px; /* Curved iframe container */
        overflow: hidden;
        border: 1px solid #222;
      }

      #tv-frame { width: 100%; height: 100%; border: none; }

      /* RIGHT EPISODE AREA */
      .tv-right {
        background: #0a0a0a;
        border-radius: 15px;
        border: 1px solid #222;
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        min-height: 0;
      }

      .tv-episodes {
        flex: 1;
        overflow-y: auto;
        background: #000;
        border-radius: 8px;
        padding: 5px;
      }

      /* CONTROLS AREA */
      .player-controls {
        height: 75px;
        display: flex;
        align-items: center;
        padding: 0 25px;
        justify-content: flex-start;
      }

      #reload-btn {
        background: rgba(255, 255, 255, 0.08);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.15);
        width: 50px; height: 50px;
        border-radius: 50%;
        font-size: 20px;
        cursor: pointer;
        transition: 0.2s;
        display: flex; align-items: center; justify-content: center;
      }

      #reload-btn:hover { background: rgba(255, 255, 255, 0.2); transform: scale(1.1); }

      /* PROXY LOADING TEXT */
      .player-loading {
        position: absolute; inset: 0;
        display: flex; align-items: center; justify-content: center;
        flex-direction: column;
        background: #000; z-index: 10;
        color: #fff; font-size: 10px; text-align: center;
        line-height: 1.8;
      }

      /* ELEMENTS TO HIDE */
      .player-info { display: none; }

      /* UI TUNING */
      #season-select {
        width: 100%; font-family: 'Press Start 2P';
        font-size: 9px; background: #111; color: #fff;
        border: 1px solid #333; padding: 5px; border-radius: 5px;
      }
      .tv-episode-btn {
        width: 100%; background: transparent; border: 1px solid #222;
        color: #fff; font-family: 'Press Start 2P'; font-size: 7px;
        padding: 8px; margin-bottom: 5px; cursor: pointer; text-align: left;
        border-radius: 4px;
      }
      .tv-episode-btn.active { border-color: #00ff7f; color: #00ff7f; background: rgba(0,255,127,0.1); }
    </style>
  </head>

  <body>
    <nav class="side-header">
      <a href="index.html" class="side-icon" data-icon="home"><img></a>
      <a href="games.html" class="side-icon" data-icon="games"><img></a>
      <a href="media.html" class="side-icon" data-icon="media"><img></a>
      <a href="ai.html" class="side-icon" data-icon="ai">
  <img />
</a>

      <a href="settings.html" class="side-icon" data-icon="settings"><img></a>
    </nav>

    <main class="player-main">
      <div class="tv-shell">
        <div class="tv-main-layout">
          <section class="tv-left">
            <div class="player-frame-wrap">
              <div id="player-loading" class="player-loading">
                CONNECTING TO PROXY…
                <span style="margin-top:10px; opacity:0.6; font-size:8px;">PLEASE WAIT...</span>
              </div>
              <iframe id="tv-frame" src="about:blank" allowfullscreen></iframe>
            </div>
          </section>

          <aside class="tv-right">
            <div style="font-size: 8px; margin-bottom: 5px; color: #777;">SELECT SEASON</div>
            <select id="season-select"></select>
            <div id="tv-episodes" class="tv-episodes"></div>
          </aside>
        </div>
      </div>

      <div class="player-controls">
        <button id="reload-btn" title="Reload Stream">↻</button>
      </div>
    </main>

    <script>
      // Sidebar Logic
      function getAccent() { return localStorage.getItem("s0laceAccent") || "gray"; }
      function updateSideIcons() {
        const accent = getAccent();
        document.querySelectorAll(".side-icon").forEach(link => {
          const icon = link.dataset.icon;
          const img = link.querySelector("img");
          const isActive = location.pathname.endsWith(link.getAttribute("href"));
          link.classList.toggle("active", isActive);
          img.src = `thumbs/${icon}/${isActive ? accent : "gray"}.png`;
        });
      }
      updateSideIcons();
    </script>

    <script>
      (async () => {
        const params = new URLSearchParams(window.location.search);
        const tmdbId = params.get("id");
        let currentSeason = parseInt(params.get("season") || "1", 10);
        let currentEpisode = parseInt(params.get("episode") || "1", 10);

        const frame = document.getElementById("tv-frame");
        const loadingEl = document.getElementById("player-loading");
        const reloadBtn = document.getElementById("reload-btn");
        const seasonSelect = document.getElementById("season-select");
        const episodesBox = document.getElementById("tv-episodes");

        function updateFrame() {
          loadingEl.style.display = "flex";
          frame.src = `/scramjet/https://cinemaos.tech/embed/${tmdbId}/${currentSeason}/${currentEpisode}`;
        }

        reloadBtn.addEventListener("click", updateFrame);
        frame.addEventListener("load", () => { loadingEl.style.display = "none"; });

        async function init() {
          if (!tmdbId) return;
          
          // Fetch Seasons
          const res = await fetch(`https://api.themoviedb.org/3/tv/${tmdbId}?api_key=2d1351cf74f73892042699d0431b799a`);
          const data = await res.json();
          
          data.seasons.forEach(s => {
            if (s.season_number === 0) return;
            const opt = document.createElement("option");
            opt.value = s.season_number;
            opt.textContent = `Season ${s.season_number}`;
            if (s.season_number === currentSeason) opt.selected = true;
            seasonSelect.appendChild(opt);
          });

          await loadEpisodes(currentSeason);
          updateFrame();
        }

        async function loadEpisodes(sNum) {
          const res = await fetch(`https://api.themoviedb.org/3/tv/${tmdbId}/season/${sNum}?api_key=2d1351cf74f73892042699d0431b799a`);
          const data = await res.json();
          episodesBox.innerHTML = "";
          data.episodes.forEach(ep => {
            const btn = document.createElement("button");
            btn.className = "tv-episode-btn" + (ep.episode_number === currentEpisode ? " active" : "");
            btn.textContent = `E${ep.episode_number}: ${ep.name.substring(0, 15)}...`;
            btn.onclick = () => {
              currentEpisode = ep.episode_number;
              document.querySelectorAll(".tv-episode-btn").forEach(b => b.classList.remove("active"));
              btn.classList.add("active");
              updateFrame();
            };
            episodesBox.appendChild(btn);
          });
        }

        seasonSelect.onchange = (e) => {
          currentSeason = e.target.value;
          currentEpisode = 1;
          loadEpisodes(currentSeason);
          updateFrame();
        };

        init();
      })();
    </script>
  </body>
</html>
